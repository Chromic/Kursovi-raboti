#define _CRT_SECURE_NO_WARNINGS
#include "stdafx.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct Student 
{
	char ime[50];
	int fn, nm;
	int ocfiz[10], ocmat[10], ocpro[10];
};
char filename[20];

FILE *fd;

Student ps;

void createFile()
{
	fd = fopen(filename, "wb");
	fclose(fd);
	printf("File created!\n");
}

void readStud(Student *s) 
{
	printf("Enter data for new student");
	getchar();
	
	printf("\nEnter student name:"); 
	gets_s(s->ime);
	
	printf("\nEnter FN:");
	scanf_s("%d", &s->fn);
	
	printf("\nEnter marks for Maths, Programming, Physics");
	printf("\n Number of Maths marks: ");
	int n;
	scanf_s("%d", &s->nm);
	for (int i = 0; i < ps.nm; i++) {
		printf("\n # %d ",i+1);
		scanf_s("%d", &s->ocmat);
	}
	printf("\nNumber of programming marks: ");
	scanf_s("%d", &s->nm);
	for (int i = 0; i < ps.nm; i++) {
		printf("\n # %d", i+1);
		scanf_s("%d", &s->ocpro);
	}

	printf("\nPhysics");
	scanf_s("%d", &s->ocfiz);
	getchar(); 
}
void addStud() 
{
	fd = fopen(filename, "a+b");
	char c;
	do 
	{
		readStud(&ps);
		fwrite(&ps, sizeof(ps), 1, fd);
		printf("More Students? (y/n) : ");
		c = getchar(); getchar();
	} 
	while (c == 'y');
	fclose(fd);
}

void writeAllStud() 
{
		fd = fopen(filename, "rb");
		printf("students in file\n");
		fread(&ps, sizeof(ps), 1, fd);
		while (!feof(fd)) 
		{
			printf("%s fn: %d ocmat: %d ocpro: %d ocfiz: %d", ps.ime, ps.fn, ps.ocmat, ps.ocpro, ps.ocfiz);
			fread(&ps, sizeof(ps), 1, fd);
		}
	fclose(fd);
}
/*
void changeStud() 
{
	int fn2;
	printf("enter FN:");
	scanf_s("%d", &fn2);
	fd = fopen(filename, "r+b");
	fread(&ps, sizeof(ps), 1, fd);
	while (!feof(fd)) {
		if (ps.fn == fn2)
		{

			fseek(fd, -(long) sizeof(ps), SEEK_CUR);
			fwrite(&ps, sizeof(ps, 1, fd));
			break;
		}
	}
}*/

void Avg() 
{

}

void exportData() 
{
	FILE *txt;
	txt = fopen("students.txt", "wt");
	fd = fopen(filename, "rb");
	fread(&ps, sizeof(ps), 1, fd);
	while (!feof(fd)) 
	{
		fprintf(txt, "%d %s marks are - fiz %d mat %d prog %d \n", ps.fn, ps.ime, ps.ocfiz, ps.ocmat, ps.ocpro);
		fread(&ps, sizeof(ps), 1, fd);
	}
	fclose(fd);
	fclose(txt);
	printf("students have been written to a text file.\n");
}
void main() 
{
	printf("Enter file name:");
	gets_s(filename);
	int c;
	do 
	{
		printf("\nMenu:\n");
		printf("0 Exit\n");
		printf("1 Create file\n");
		printf("2 Add new student data\n");
		printf("3 Change data from FN\n");
		printf("4 AVG marks for maths, programming, physics\n");
		printf("5 export all AVG marks to .txt file\n");
		printf("6 display data of all students");
		scanf("%d", &c);
		switch (c) 
		{
		case 1: createFile(); break;
		case 2: addStud(); break;
		//case 3: changeStud; break;
		case 4: Avg(); break;
		case 5: exportData(); break;
		case 6: writeAllStud(); break;
		}
	} 
	while (c != 0);
}
